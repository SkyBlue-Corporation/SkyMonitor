<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyMonitor - Système de Monitoring</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
    // Crée une connexion Socket.IO globale en forçant WebSocket
    if (typeof io !== 'undefined') {
        try {
            window.socket = io({
                transports: ["websocket"], // force WebSocket
                upgrade: false             // empêche le fallback vers polling
            });

            window.socket.on("connect", () => {
                console.log("✅ Socket.IO connecté via WebSocket");
            });

            window.socket.on("disconnect", (reason) => {
                console.warn("❌ Socket.IO déconnecté :", reason);
            });

            window.socket.on("connect_error", (err) => {
                console.error("⚠️ Erreur de connexion Socket.IO :", err.message);
            });
        } catch (e) {
            console.warn("Socket.IO init failed:", e);
        }
    }
    </script>
</head>
<body>
    <!-- Animation monitoring lors des transitions de page -->
    <div id="monitoring-loader" style="display:none;"></div>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-chart-network"></i>
            <span>SkyMonitor</span>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-link" data-route="/">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </a>
            <a href="/dashboard" class="nav-link" data-route="/dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="/serveurs" class="nav-link" data-route="/serveurs">
                <i class="fas fa-server"></i>
                <span>Serveurs</span>
            </a>
            <a href="/postes" class="nav-link" data-route="/postes">
                <i class="fas fa-desktop"></i>
                <span>Postes</span>
            </a>
            <a href="/conteneurs" class="nav-link" data-route="/conteneurs">
                <i class="fas fa-box"></i>
                <span>Conteneurs</span>
            </a>
            <a href="/metriques" class="nav-link" data-route="/metriques">
                <i class="fas fa-chart-line"></i>
                <span>Métriques</span>
            </a>
            <a href="/parametres" class="nav-link" data-route="/parametres">
                <i class="fas fa-cog"></i>
                <span>Paramètres</span>
                <a href="/login" class="nav-link" data-route="/login"></a>
        </div>
        <div class="nav-user">
            <i class="fas fa-user-circle"></i>
            <span>Administrateur</span>
            <button id="theme-toggle" class="btn btn-outline" title="Changer de thème">
                <i class="fas fa-adjust"></i> Thème
            </button>
        </div>
        <!-- Statut de connexion & mini-métriques en direct -->
        <div class="nav-status">
            <div id="connection-indicator" class="connection disconnected" title="Socket.IO: déconnecté">
                <i class="fas fa-circle"></i>
            </div>
            <div class="nav-stats">
                <div class="nav-stat"><i class="fas fa-microchip"></i> <span id="nav-cpu-value">--%</span></div>
                <div class="nav-stat"><i class="fas fa-memory"></i> <span id="nav-memory-value">--%</span></div>
                <div class="nav-stat"><i class="fas fa-hdd"></i> <span id="nav-disk-value">--%</span></div>
            </div>
            <span id="sim-badge" class="sim-badge" style="display:none;" title="Les valeurs affichées sont simulées">Simulées</span>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main id="main-content">
         <section id="metrics-visual">
            <section id="network-scan">
    <h2>Scan Réseau</h2>
<button id="launchScan" class="btn btn-primary">
    <i class="fas fa-search"></i> Lancer le scan réseau
  </button>
  <button id="simulateProgress" class="btn btn-outline" style="margin-top:1em;">
    <i class="fas fa-tasks"></i> Simuler la barre de progression
</button>
  <!-- Barre de progression en dehors du bouton -->
<div id="scan-progress-bar" class="progress-bar" style="margin-top:1em; display:none;">
  <div id="scan-progress-fill" class="progress-fill"></div>
</div>
  <!-- zone de Statut -->
  <div id="scan-status" style="margin-top:1em;"></div>
  <table id="scanTable" style="margin-top:1em; display:none;">
    <thead>
      <tr><th>IP</th><th>Ports ouverts</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>
        <h2>Évolution du CPU</h2>
        <canvas id="metricsChart" width="600" height="300"></canvas>
    </section>
        <!-- Le contenu sera chargé dynamiquement par le router -->
    </main>

    <!-- Pied de page commun -->
    <footer class="site-footer">
        <div class="footer-content">
            <span id="copyright">© 2025 SkyBlue Corporation</span>
            <span class="footer-sep">|</span>
            <a href="/mentions-legales" class="footer-link" title="Mentions légales"><i class="fas fa-balance-scale"></i> Mentions légales</a>
            <span class="footer-sep">|</span>
            <a href="/contact" class="footer-link" title="Contact"><i class="fas fa-envelope"></i> Contact</a>
            <span class="footer-sep">|</span>
            <a href="/support" class="footer-link" title="Support"><i class="fas fa-life-ring"></i> Support</a>
            <span class="footer-sep">|</span>
            <a href="/confidentialite" class="footer-link" title="Politique de confidentialité"><i class="fas fa-user-shield"></i> Confidentialité</a>
        </div>
        <div class="footer-legal">
            <small>
                Ce site respecte la réglementation RGPD. Les données collectées sont utilisées uniquement pour le monitoring et ne sont jamais revendues. Pour toute demande concernant vos données personnelles, contactez-nous à <a href="mailto:legal@skyblue-corp.com">codecld@proton.me</a>.
            </small>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/static/js/router.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
